hw_schema_version: 1
schema: |
  definition spice_schema_migrations/version {}

  definition spice_schema_migrations/migration {
    relation version: spice_schema_migrations/version
  }

  definition user {}

  definition team {
  	relation leader: user
  	relation member: user

  	permission leadership = leader
  	permission membership = leader + member
  	permission invite_member = leader
  	permission remove_member = leader
  }

  definition team_invite {
  	relation user: user
  	relation team: team
  	
  	permission view = user + team->leadership
  	permission accept = user
  	permission deny = user
  	permission cancel = team->leadership
  }

  // all of this is made up and needs to be replaced
  definition patient {
    	relation doctor: user | team#membership
    	
    	permission view = doctor
    	permission discharge = doctor
    	permission schedule_gdpr_delete = doctor
  }

  definition task {
  	relation assignee: user
  	relation patient: patient

  	permission view = assignee + patient->view
  	permission delete = assignee + patient->view
    permission assign = patient->view
  }
relationships: |-
  team:a#leader@user:alice
  team:b#leader@user:bob
  team:a#member@user:alice
  team:b#member@user:bob
  team:a#member@user:charlie
  team:b#member@user:charlie
  team:a#member@user:clara
  team:b#member@user:clara
  team:a#leader@user:clara
  team_invite:1#user@user:eve
  team_invite:1#team@team:a
assertions:
  assertTrue:
    - team:a#leadership@user:alice
    - team:a#membership@user:alice
    - team:a#leadership@user:clara
    - team:a#membership@user:clara
    - team:b#membership@user:clara
    - team:a#invite_member@user:clara
    - team_invite:1#view@user:eve
    - team_invite:1#view@user:alice
    - team_invite:1#cancel@user:alice
    - team_invite:1#accept@user:eve
  assertFalse:
    - team:b#leadership@user:alice
    - team:b#leadership@user:clara
    - team:a#invite_member@user:charlie
    - team:b#invite_member@user:charlie
    - team:b#invite_member@user:clara
    - team_invite:1#view@user:bob
    - team_invite:1#cancel@user:eve
    - team_invite:1#cancel@user:bob
    - team_invite:1#accept@user:alice
validation:
  team_invite:1#accept:
    - "[user:eve] is <team_invite:1#user>"
  team_invite:1#cancel:
    - "[user:alice] is <team:a#leader>"
    - "[user:clara] is <team:a#leader>"
  team_invite:1#deny:
    - "[user:eve] is <team_invite:1#user>"
  team_invite:1#view:
    - "[user:alice] is <team:a#leader>"
    - "[user:clara] is <team:a#leader>"
    - "[user:eve] is <team_invite:1#user>"
