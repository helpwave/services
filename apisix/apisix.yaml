upstreams:
  - id: dapr-grpc
    nodes:
      "localhost:35001": 1
    scheme: grpc
    type: roundrobin

services:
  - id: task-svc
    upstream_id: dapr-grpc
    plugins:
      grpc-web: {}
      proxy-rewrite:
        headers:
          add:
            dapr-app-id: task-svc
  - id: auth-svc
    upstream_id: dapr-grpc
    plugins:
      grpc-web: {}
      proxy-rewrite:
        headers:
          add:
            dapr-app-id: auth-svc
  - id: user-svc
    upstream_id: dapr-grpc
    plugins:
      grpc-web: {}
      proxy-rewrite:
        headers:
          add:
            dapr-app-id: user-svc

routes:
  - id: task-svc
    uri: /task-svc/*
    service_id: task-svc
    plugins:
      cors:
        # TODO: Scope to grpc-web spec
        allow_origins: "**"
        allow_methods: "**"
        allow_headers: "**"
        expose_headers: "**"
        max_age: 5
        allow_credential: true
        _meta:
          priority: -1
  - id: auth-svc
    uri: /auth-svc/*
    service_id: auth-svc
    plugins:
      cors:
        # TODO: Scope to grpc-web spec
        allow_origins: "**"
        allow_methods: "**"
        allow_headers: "**"
        expose_headers: "**"
        max_age: 5
        allow_credential: true
        _meta:
          priority: -1
  - id: user-svc
    uri: /user-svc/*
    service_id: user-svc
    plugins:
      cors:
        # TODO: Scope to grpc-web spec
        allow_origins: "**"
        allow_methods: "**"
        allow_headers: "**"
        expose_headers: "**"
        max_age: 5
        allow_credential: true
        _meta:
          priority: -1

#END
